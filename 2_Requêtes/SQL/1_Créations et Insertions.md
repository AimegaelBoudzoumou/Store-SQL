# Création de tables et Insertion d'au moins une occurrence

```sql
/*##############################################################################################################
marques (nom_marque, date_creation_marque,
         #matricule_employe_etre_acheteur, #matricule_employe_etre_chef_de_produit) 
###############################################################################################################*/

DROP TABLE marques CASCADE CONSTRAINTS;

CREATE TABLE marques (
    idValue NUMBER GENERATED BY DEFAULT AS IDENTITY,
    code_marque INT,
    nom_marque VARCHAR2(255) NOT NULL,
    date_creation_marque DATE NOT NULL,
    matricule_employe_etre_acheteur VARCHAR2(255) NULL,       -- L'acheteur(se) pourra être affecté plus tard sur le produit.
    matricule_employe_etre_chef_de_produit VARCHAR2(255) NULL,
    PRIMARY KEY (code_marque)
);

INSERT INTO marques(code_marque, nom_marque, date_creation_marque) VALUES (22, 'Apple', TO_CHAR(SYSDATE));
INSERT INTO marques(code_marque, nom_marque, date_creation_marque, matricule_employe_etre_acheteur, matricule_employe_etre_chef_de_produit)
	VALUES (24, 'Samsung', TO_CHAR(SYSDATE), 56548, NULL);

SELECT * FROM marques WHERE MATRICULE_EMPLOYE_ETRE_ACHETEUR IS NULL;

-------------------------------------------------------------- 
/*##############################################################################################################
gammes (nom_gamme, date_creation_gamme, #nom_marque) 
###############################################################################################################*/

DROP TABLE gammes CASCADE CONSTRAINTS;

CREATE TABLE gammes (
    idValue NUMBER GENERATED BY DEFAULT AS IDENTITY,
    code_gamme INT,
    nom_gamme VARCHAR2(255) NOT NULL,
    date_creation_gamme DATE NOT NULL,
    code_marque INT NOT NULL, -- Une gamme est obligatoirement liées à une marque
    PRIMARY KEY (code_gamme)
);
ALTER TABLE gammes ADD CONSTRAINT FK_gammes_code_marque FOREIGN KEY (code_marque) REFERENCES marques (code_marque);

INSERT INTO gammes (code_gamme, nom_gamme, date_creation_gamme, code_marque) VALUES (89, 'iphone 16e', TO_CHAR(SYSDATE), 22);

SELECT * FROM gammes;

-------------------------------------------------------------- categories (nom_categorie, date_creation_categorie)

DROP TABLE categories CASCADE CONSTRAINTS;

CREATE TABLE categories (
    idValue NUMBER GENERATED BY DEFAULT AS IDENTITY,
    code_categorie INT,
    nom_categorie VARCHAR2(255) NOT NULL,
    date_creation_categorie DATE NOT NULL,
    PRIMARY KEY (code_categorie)
);

INSERT INTO categories (code_categorie, nom_categorie, date_creation_categorie) VALUES (70, 'téléphone portable', TO_CHAR(SYSDATE));

SELECT * FROM categories;

-------------------------------------------------------------- phases (nom_phase, signification)

DROP TABLE phases CASCADE CONSTRAINTS;
CREATE TABLE phases (
    idValue NUMBER GENERATED BY DEFAULT AS IDENTITY,
    code_phase INT,
    nom_phase VARCHAR2(255) NOT NULL,
    signification VARCHAR2(255) NULL,
    PRIMARY KEY (code_phase)
);

INSERT INTO phases (code_phase, nom_phase, signification) VALUES (43, 'A statuer', NULL);

-------------------------------------------------------------- types_de_produit (nom_type)

DROP TABLE types_de_produit CASCADE CONSTRAINTS;

CREATE TABLE types_de_produit (
	idValue NUMBER GENERATED BY DEFAULT AS IDENTITY,
    code_types_de_produit INT,
    nom_type VARCHAR(255) NOT NULL,
    PRIMARY KEY (code_types_de_produit)
);

INSERT INTO types_de_produit(code_types_de_produit, nom_type) VALUES (80, 'Physique');

SELECT * FROM types_de_produit;

-------------------------------------------------------------- employes (matricule_employe, nom_employe, prenom_employe, full_name_employe) --------------------

DROP TABLE employes CASCADE CONSTRAINTS;
CREATE TABLE employes (
    idValue NUMBER GENERATED BY DEFAULT AS IDENTITY,
    matricule_employe INT NOT NULL, 
    nom_employe VARCHAR2(100) NOT NULL, 
    prenom_employe VARCHAR2(100) NOT NULL,
    full_name_employe VARCHAR2(255) GENERATED ALWAYS AS (
    	prenom_employe || ' ' || nom_employe    
    ),
    PRIMARY KEY(matricule_employe)
);

INSERT INTO employes(matricule_employe, nom_employe, prenom_employe) VALUES (134898, 'Beranger', 'Eléonore');
SELECT * FROM employes;

-------------------------------------------------------------- produits (reference_fabricant, reference_interne, date_creation_produit, date_derniere_commande, visibilite_web, titre, designation, description_produit, quantite_globale, filtre_gamme, filtre_categorie, #nom_phase, #nom_type, #nom_categorie, #nom_gamme)

-- titre sera de la forme « Fabricant_Marque - Gamme Référence_fabricant »

DROP TABLE produits CASCADE CONSTRAINTS;
CREATE TABLE produits (
    idValue NUMBER GENERATED BY DEFAULT AS IDENTITY,
    reference_interne INT NOT NULL, -- floor(dbms_random.value(7000000, 7999999)) -- dans la pratique du développement logiciel : il est possible de générer à part cette réf et vérifier qu'elle n'existe pas déjà dans le système avant de l'utiliser pour la création d'un produit
    reference_fabricant VARCHAR2(100) NOT NULL,    
    date_creation_produit DATE NOT NULL, -- Très important, par exemple pour savoir le nombre de produits créés à une période données
    date_derniere_commande DATE NULL, 
    visibilite_web VARCHAR2(3) NOT NULL, -- par défaut à : non
    titre VARCHAR2(255) GENERATED ALWAYS AS (
    	code_gamme || ' - ' || reference_fabricant
    ), --titre : après la création d'un produit, le titre sera modifié pour qu'il soit de la forme « Fabricant_Marque - Gamme Référence_fabricant ». Cette modification se fera via une procédure PL/SQL.
    designation VARCHAR2(255) NULL, 
    description_produit VARCHAR2(255) NULL, 
    quantite_globale INT NOT NULL, -- sera de la forme -- floor(dbms_random.value(0, 500)) -- Le choix de l'intervalle 0 à 500 est aléatoire
    filtre_gamme CHAR, -- soit "1" (pour présence d'un filtre gamme), soit "0" (pour absence d'un filtre gamme)
    filtre_categorie CHAR, -- soit "1" (pour présence d'un filtre categorie), soit "0" (pour absence d'un filtre categorie)
    code_phase INT NOT NULL,            -- clé étrangère -- par défaut à "43 ==> A statuer"
    code_types_de_produit INT NOT NULL, -- clé étrangère
    code_categorie INT NOT NULL,        -- clé étrangère
    code_gamme INT NOT NULL,            -- clé étrangère
    PRIMARY KEY (reference_interne)
);
-- ALTER TABLE produits
ALTER TABLE produits ADD CONSTRAINTS FK_produits_code_phase FOREIGN KEY (code_phase) REFERENCES phases (code_phase);
ALTER TABLE produits ADD CONSTRAINTS FK_produits_code_types_de_produit FOREIGN KEY (code_types_de_produit) REFERENCES types_de_produit (code_types_de_produit);
ALTER TABLE produits ADD CONSTRAINTS FK_produits_code_categorie FOREIGN KEY (code_categorie) REFERENCES categories (code_categorie);
ALTER TABLE produits ADD CONSTRAINTS FK_produits_code_gamme FOREIGN KEY (code_gamme) REFERENCES gammes (code_gamme);

INSERT INTO produits (reference_interne, reference_fabricant, date_creation_produit, visibilite_web, quantite_globale, filtre_gamme, filtre_categorie, code_phase, code_types_de_produit, code_categorie, code_gamme) 
    VALUES (floor(dbms_random.value(7000000, 7999999)), 'GBHGH-HU', TO_CHAR(SYSDATE), 'non', floor(dbms_random.value(0, 500)), '0', '0', 43, 80, 70, 89);
SELECT * FROM produits;
-- Ecrire une procédure PL/SQL pour mettre à jour le 'titre' d'un produit
-------------------------------------------------------------- bundles (numero, date_creation_bundle) ---------------------------------------------------------
DROP TABLE bundles CASCADE CONSTRAINTS;
CREATE TABLE bundles (
    idValue NUMBER GENERATED BY DEFAULT AS IDENTITY,
    numero INT NOT NULL,
    date_creation_bundle DATE,
    PRIMARY KEY (numero)    
);
INSERT INTO bundles (numero, date_creation_bundle) VALUES (floor(dbms_random.value(500000, 599999)), TO_CHAR(SYSDATE));
SELECT * FROM bundles;


---------------------------------------------------------------- bundle_produits (reference_fabricant, numero) --------------------------------------------------
-- Ecrire une procédure PL/SQL pour créer un 'bundle_produits'
/*
DROP TABLE bundles_produits CASCADE CONSTRAINTS;
CREATE TABLE bundle_produits (
    idValue NUMBER GENERATED BY DEFAULT AS IDENTITY,
    reference_fabricant INT NOT NULL,
    numero INT NOT NULL,
    PRIMARY KEY (reference_fabricant,numero)
);
ALTER TABLE bundle_produits ADD CONSTRAINTS FK_bundles_produits_reference_fabricant FOREIGN KEY (reference_fabricant) REFERENCES produits (reference_fabricant);
ALTER TABLE bundle_produits ADD CONSTRAINTS FK_bundles_produits_numero FOREIGN KEY (numero) REFERENCES bundles (numero);
*/

-------------------------------------------------------------- Divers
-- TO_DATE('2023-12-03', 'YY-MM-DD')
-- TO_CHAR(date_creation_produit, 'DD/MM/YYYY') as date_crea
-- SELECT TO_CHAR (SYSDATE, 'DD/MM/YYYY HH24:MI:SS') "NOW" FROM DUAL;
```
